Martin Escardo, 24th November 2025.

It is well known that in a boolean elementary (1-)topos, every algebra
of the lifting (aka partial-map classifier) monad is free, and the
proof is easy [1][2].

We show that the converse holds, so that every algebra is free if and
only if the topos is boolean (that is, the principle of excluded middle holds).

The object Î© of truth values is an algebra in (at least) two ways,
with structure map â¨† = âˆƒ and â¨† = âˆ€.

In all toposes, the structure map â¨† = âˆƒ exhibits Î© as freely generated
by âŠ¤ : Î©.

In a boolean topos, the structure map â¨† = âˆ€ exhibits Î© as freely
generated by âŠ¥ : Î©.

Moreover, the converse is true. If the structure map â¨† = âˆ€ exhibits Î©
as freely generated by âŠ¥ : Î©, then the topos is boolean.

We may wonder whether, in an arbitrary topos, the object Î© with the
structure map â¨† = âˆ€ is freely generated by *any* object G of generators.

We show that if this is the case, then

 1. the insertion of generators Î¹ : G â†’ Î© is constant with value âŠ¥,
 2. the principle of excluded middle holds, and
 3. G â‰ƒ ğŸ™.

Jon Sterling [1] previously conjectured that the same would be the
case for the lifting monad in the category of dcpos [3], namely that
there are some toposes in which there is an algebra of the lifting
monad in the category of dcpos that is not free.

We haven't (yet) formalized this here, but we offer an argument to
prove Sterling's conjecture, based on the above claims (which are
formalized below).

Anders Kock [2] proved that any algebra in the category of sets is
bounded-complete (every upper bounded set has a least upper bound).

Because the lifting algebra Î© with structure map âˆ€ has a largest
element, namely âŠ¥, it is a sup-lattice, and, in particular, directed
complete.

Regarding continuity, the structure map is always supremum (after
Kock), and suprema formation always preserve suprema, including
directed ones.

Hence the answer for the category of sets also gives an answer for the
category of dcpos in any elementary topos.

So the above discussion settles Sterling's conjecture positively, by
providing an example of a dcpo lifting algebra which is not always
free.

TODO. It would be good to formalize this here in TypeTopology.

[1] Jon Sterling. Tensorial structure of the lifting doctrine in
    constructive domain theory. Originally 28 Dec 2023, last revised 30
    Jan 2025. https://doi.org/10.48550/arXiv.2312.17023

[2] Anders Kock. Algebras for the partial-map classifier monad. In:
    Carboni, A., Pedicchio, M.C., Rosolini, G. (eds) Category
    Theory. LNM, vol 1488.
    https://doi.org/10.1007/BFb0084225
    https://tildeweb.au.dk/au76680/jonna5.pdf

[3] Anders Kock. The constructive lift monad.
    BRICS Report Series (Aarhus), ISSN 0909-0878 (1995)
    http://tildeweb.au.dk/au76680/CLM.pdf

\begin{code}

{-# OPTIONS --safe --without-K #-}

\end{code}

We import the following unused module, deliberately without opening
it, for browsing purposes, where the original ideas presented here
were obtained in a tortuous way, with more information than necessary
to obtain the results, which may nevertheless be interesting for other
purposes.

\begin{code}

import Lifting.AnAlgebraWhichIsNotAlwaysFree-blackboard

\end{code}

We now import what is necessary to give the types for the module
parameters.

\begin{code}

open import MLTT.Spartan
open import UF.FunExt
open import UF.Sets
open import UF.Subsingletons
open import UF.SubtypeClassifier renaming (Î© to Î©-of-universe ;
                                           âŠ¥ to âŠ¥Î© ;
                                           âŠ¤ to âŠ¤Î©)
\end{code}

We work with an arbitrary type universe ğ“£, and assume function
extensionality and propositional extensionality, which are available
in any 1-topos.

We also work with a hypothetical set G of generators, and an inclusion
of generators Î¹, which will, by assumption, exhibit Î© with the
structure map â¨† = âˆ€ as a free algebra, but we postpone this assumption
as much as possible.

\begin{code}

module Lifting.AnAlgebraWhichIsNotAlwaysFree
        (fe       : Fun-Ext)
        (pe       : Prop-Ext)
        (ğ“£        : Universe)
       where

open import Lifting.Algebras ğ“£
open import Lifting.Construction ğ“£
open import Lifting.EmbeddingDirectly ğ“£
open import Lifting.Identity ğ“£
open import Lifting.TwoAlgebrasOnOmega ğ“£ fe pe
             renaming (Î -alg-on-Î© to Î©âˆ€ ; Î£-alg-on-Î© to Î©âˆƒ)
open import UF.ClassicalLogic
open import UF.Embeddings
open import UF.Equiv
open import UF.Logic
open import UF.SubtypeClassifier-Properties

open Implication fe renaming (Â¬â‚š_ to â‡_)
open Universal fe

\end{code}

Some abbreviations now.

\begin{code}

private
 ğ“£âº = ğ“£ âº

 Î© : ğ“£âº Ì‡
 Î© = Î©-of-universe ğ“£

 fe' : FunExt
 fe' ğ“¤ ğ“¥ = fe {ğ“¤} {ğ“¥}

\end{code}

To achieve our objectives stated above, we will soon assume that
Î© equipped with the structure map âˆ€ is indeed freely generated by G
with insertion of generators Î¹, which implies that h is an
equivalence. But we can prove a few things before we assume that.

We have the algebra ğ“› G freely generated by G, with insertion of
generators Î· : G â†’ ğ“› G, and in particular a unique algebra
homomorphism h : ğ“› G â†’ Î©, for Î© equipped with the âˆ€ lifting structure,
extending Î¹ along Î·.

       Î·
  G â”€â”€â”€â”€â”€â”€â”€â†’ ğ“› G
   â•²          â”‚
    â•²         â”‚
     â•²        â”‚
    Î¹ â•²    h  â”‚
       â•²      â”‚
        â•²     â”‚
         â•²    â”‚
          â•²   â†“
           â˜  Î©.

\begin{code}

module Î©âˆ€-free-gives-EM
        (G        : ğ“£ Ì‡ )
        (G-is-set : is-set G)
        (Î¹        : G â†’ Î©-of-universe ğ“£)
       where

 open free-algebras-in-the-category-of-sets pe fe G G-is-set

 ğ“›G : ğ“›-alg (ğ“› G)
 ğ“›G = canonical-free-algebra

 h : ğ“› G â†’ Î©
 h = ğ“›-extension (Î©-is-set fe pe) Î©âˆ€ Î¹

 h-explicitly : (l@(P , Ï† , i) : ğ“› G) â†’ h l ï¼ (â±¯ a ê‰ P , Î¹ (Ï† a))
 h-explicitly _ = by-definition

 h-is-hom : is-hom ğ“›G Î©âˆ€ h
 h-is-hom = ğ“›-extension-is-hom (Î©-is-set fe pe) Î©âˆ€ Î¹

 h-extends-Î¹ : h âˆ˜ Î· âˆ¼ Î¹
 h-extends-Î¹ = ğ“›-extension-extends (Î©-is-set fe pe) Î©âˆ€ Î¹

 h-at-âŠ¥-is-âŠ¤ : h âŠ¥ ï¼ âŠ¤Î©
 h-at-âŠ¥-is-âŠ¤ = h âŠ¥                               ï¼âŸ¨by-definitionâŸ©
               h (ğŸ˜ , unique-from-ğŸ˜ , ğŸ˜-is-prop) ï¼âŸ¨ h-explicitly âŠ¥ âŸ©
               (â±¯ a ê‰ ğŸ˜ , Î¹ (unique-from-ğŸ˜ a))   ï¼âŸ¨ I âŸ©
               (ğŸ™ , ğŸ™-is-prop)                   ï¼âŸ¨by-definitionâŸ©
               âŠ¤Î©                                âˆ
  where
   I = Î©-extensionality pe fe (Î» _ â†’ â‹†) (Î» (_ : ğŸ™) (a : ğŸ˜) â†’ ğŸ˜-elim a)

\end{code}

Now we assume that âˆ€Î© is freely generated by G with insertion of
generators Î¹, from which the principle of excluded will follow.

\begin{code}

 module _ (Î©âˆ€-is-free : is-free-ğ“›-alg Î©âˆ€ G Î¹) where

\end{code}

All we need to reach our desired conclusions is that the map h is an
equivalence, and so our assumption is slightly stronger than needed.

To show that h is an equivalence from this assumption, consider the
diagram below, where ğ“› G is freely generated by G with insertion of
generators Î·, and Î© equipped with âˆ€ is freely generated by G with
insertion of generators Î¹. So the conclusion is a standard categorical
argument.

       Î·
  G â”€â”€â”€â”€â”€â”€â”€â†’ ğ“› G
   â•²         â”‚ â†‘
    â•²        â”‚ â”‚
     â•²       â”‚ â”‚
    Î¹ â•²    h â”‚ â”‚ hâ»Â¹
       â•²     â”‚ â”‚
        â•²    â”‚ â”‚
         â•²   â”‚ â”‚
          â•²  â†“ â”‚
           â˜  Î©.

Both ğ“› G and Î© satisfy the universal property indicated in the above
diagram, with h being the unique homomorphism extending Î¹ along Î·, and
hâ»Â¹ being the unique homomorphism extending Î· along Î¹.

\begin{code}

  h-is-equiv : is-equiv h
  h-is-equiv = unique-hom-is-equiv G
                (ğ“›-is-set fe fe pe G-is-set) (Î©-is-set fe pe) G-is-set
                Î· Î¹ ğ“›G Î©âˆ€ ğ“›-is-free Î©âˆ€-is-free

  ğ•™ : ğ“› G â‰ƒ Î©
  ğ•™ = h , h-is-equiv

  hâ»Â¹ : Î© â†’ ğ“› G
  hâ»Â¹ = âŒœ ğ•™ âŒâ»Â¹

\end{code}

Using this, we in turn conclude that our assumed insertion of
generators Î¹ : G â†’ Î© is constantly âŠ¥.

The trick is, given a generator g : G, to consider the partial element
l : ğ“› G defined by

 l = (Î¹ g holds , (Î» _ â†’ g) , _),

which will prove to be âŠ¥ : ğ“› G, and to consider the partial element Ï†
of ğ“› G with domain of definition `Î¹ g holds` and constant value `Î· g`
for that purpose.

\begin{code}

  Î¹-is-constantly-âŠ¥ : (g : G) â†’ Î¹ g ï¼ âŠ¥Î©
  Î¹-is-constantly-âŠ¥ g = III
   where
    i : is-prop (Î¹ g holds)
    i = holds-is-prop (Î¹ g)

    Ï† : Î¹ g holds â†’ ğ“› G
    Ï† _ = Î· g

    I = h (â¨† i Ï†)                   ï¼âŸ¨ h-is-hom (Î¹ g holds) i Ï† âŸ©
        (â±¯ a ê‰ Î¹ g holds , h (Ï† a)) ï¼âŸ¨by-definitionâŸ©
        (â±¯ _ ê‰ Î¹ g holds , h (Î· g)) ï¼âŸ¨by-definitionâŸ©
        Î¹ g â‡’ h (Î· g)               ï¼âŸ¨ ap (Î¹ g â‡’_) (h-extends-Î¹ g) âŸ©
        Î¹ g â‡’ Î¹ g                   ï¼âŸ¨ anything-implies-itself-is-âŠ¤ pe (Î¹ g) âŸ©
        âŠ¤Î©                          ï¼âŸ¨ h-at-âŠ¥-is-âŠ¤ â»Â¹ âŸ©
        h âŠ¥                         âˆ

    II = (Î¹ g holds , (Î» _ â†’ g) , i)       ï¼âŸ¨ IIâ‚€ âŸ©
         ((Î¹ g holds Ã— ğŸ™) , (Î» _ â†’ g) , _) ï¼âŸ¨by-definitionâŸ©
         â¨† i Ï†                             ï¼âŸ¨ equivs-are-lc h h-is-equiv I âŸ©
         âŠ¥                                 âˆ
        where
         IIâ‚€ = from-â‹ pe fe fe (((Î» p â†’ p , â‹†) , prâ‚) , (Î» _ â†’ by-definition))

    III : Î¹ g ï¼ âŠ¥Î©
    III = to-Î©-ï¼ fe (ap is-defined II)

\end{code}

And from this we get the following characterization of h. For this
purpose, recall that is-def l is the domain of definition p = (P , i) : Î©
of the partial element l = (P , Ï† , i). In particular, notice that the
value of h at the argument l doesn't depend on Ï† : P â†’ G. But we will
see that G â‰ƒ ğŸ™, so that Ï† doesn't do anything useful anyway.

The only thing going on in the following proof is that Î¹ (Ï† a) ï¼ âŠ¥Î©,
as proved above. The rest is just bureaucracy.

\begin{code}

  h-more-explicitly : (l : ğ“› G) â†’ h l ï¼ â‡ is-def l
  h-more-explicitly l@(P , Ï† , i) = I
   where
    I = h l                 ï¼âŸ¨ h-explicitly l âŸ©
        (â±¯ a ê‰ P , Î¹ (Ï† a)) ï¼âŸ¨ Iâ‚€ âŸ©
        (â±¯ a ê‰ P , âŠ¥Î©)      ï¼âŸ¨by-definitionâŸ©
        â‡ is-def l          âˆ
      where
       Iâ‚€ = Î©-extensionality pe fe
             (Î» f a â†’ idtofun _ _ (ap _holds (Î¹-is-constantly-âŠ¥ (Ï† a))) (f a))
             (Î» Î½ a â†’ ğŸ˜-elim (Î½ a))
\end{code}

We say that a type is negative if it is logically equivalent to a
negated type. We have that a type is negative if and only if it is
Â¬Â¬-stable (because three negations imply one). By the above
characterization of h and the fact that h is an equivalence, every
proposition is negative, which means that the principle of excluded
middle holds.

\begin{code}

  DNE-holds : (P : ğ“£ Ì‡) â†’ is-prop P â†’ Â¬Â¬ P â†’ P
  DNE-holds P P-is-prop = V
   where
    p q : Î©
    p = (P , P-is-prop)
    q = is-def (hâ»Â¹ p)

    Q : ğ“£ Ì‡
    Q = q holds

    I = p                ï¼âŸ¨ (inverses-are-sections' ğ•™ p)â»Â¹ âŸ©
        h (hâ»Â¹ p)        ï¼âŸ¨ h-more-explicitly (hâ»Â¹ p) âŸ©
        â‡ is-def (hâ»Â¹ p) ï¼âŸ¨by-definitionâŸ©
        â‡ q              âˆ

    II : P ï¼ (â‡ q) holds
    II = ap _holds I

    III : P â†’ Â¬ Q
    III g q = ğŸ˜-elim (idtofun P (Q â†’ ğŸ˜) II g q)

    IV : Â¬ Q â†’ P
    IV Î½ = idtofun (Q â†’ ğŸ˜) P (II â»Â¹) (Î» (b : Q) â†’ ğŸ˜-elim (Î½ b))

    V : Â¬Â¬ P â†’ P
    V = negative-types-are-Â¬Â¬-stable P (Q , III , IV)

  EM-holds : (P : ğ“£ Ì‡) â†’ is-prop P â†’ P + Â¬ P
  EM-holds = DNE-gives-EM fe DNE-holds

\end{code}

This concludes the proof of the main result of this file, namely that
if Î©âˆ€ is freely generated by any set G of generators with insertion of
generators Î¹ : G â†’ Î©, then the topos is boolean.

In principle, the hypothetical G and Î¹ are arbitrary, but we already
know that Î¹ must be constantly âŠ¥, and so it is not really arbitrary.
We now record that G isn't arbitrary either: we have that G â‰ƒ ğŸ™.

\begin{code}

  G-is-prop : is-prop G
  G-is-prop gâ‚€ gâ‚ = II
   where
    I = h (Î· gâ‚€) ï¼âŸ¨ h-extends-Î¹ gâ‚€ âŸ©
        Î¹ gâ‚€     ï¼âŸ¨ Î¹-is-constantly-âŠ¥ gâ‚€ âŸ©
        âŠ¥Î©       ï¼âŸ¨ (Î¹-is-constantly-âŠ¥ gâ‚)â»Â¹ âŸ©
        Î¹ gâ‚     ï¼âŸ¨ (h-extends-Î¹ gâ‚)â»Â¹ âŸ©
        h (Î· gâ‚) âˆ

    II : gâ‚€ ï¼ gâ‚
    II = embeddings-are-lc Î·
          (Î·-is-embedding pe fe fe fe)
          (equivs-are-lc h h-is-equiv I)

  G-is-nonempty : Â¬Â¬ G
  G-is-nonempty G-is-empty = III
   where
    I : is-prop (ğ“› G)
    I (P , Ï† , i) (Q , Ïˆ , j) =
     from-â‹ pe fe fe
      (((Î» (a : P) â†’ ğŸ˜-elim (G-is-empty (Ï† a))) ,
        (Î» (b : Q) â†’ ğŸ˜-elim (G-is-empty (Ïˆ b)))) ,
        (Î» (a : P) â†’ ğŸ˜-elim (G-is-empty (Ï† a))))

    II : hâ»Â¹ âŠ¥Î© â‰  hâ»Â¹ âŠ¤Î©
    II e = âŠ¥-is-not-âŠ¤ (equivs-are-lc hâ»Â¹ âŒœ ğ•™ âŒâ»Â¹-is-equiv e)

    III : ğŸ˜
    III = II (I (hâ»Â¹ âŠ¥Î©) (hâ»Â¹ âŠ¤Î©))

  G-is-pointed : G
  G-is-pointed = DNE-holds G G-is-prop G-is-nonempty

  G-is-ğŸ™ : G â‰ƒ ğŸ™ {ğ“£}
  G-is-ğŸ™ = singletons-are-equiv-to-ğŸ™
            (pointed-props-are-singletons G-is-pointed G-is-prop)

\end{code}

This shows that the only way Î©âˆ€ can be freely generated is with a set
of generators G â‰ƒ ğŸ™ and inclusion of generators Î¹ that is constantly âŠ¥.

Discussion. For interpreting the above results in a 1-topos, notice
that toposes validate propositional resizing, and so the two universes
ğ“£ and ğ“£âº collapse to a single one, and in fact no universe is needed,
as the only reason ğ“£âº arises is that both Î© and ğ“› G live in ğ“£âº, rather
than ğ“£, in the absence of propositional resizing. However, Agda forces
us to work with at least one universe, as opposed to MLTT, although
this is inessential.

Concluding questions. The above gives *one* example of an algebra
which if it's free then excluded middle holds. There must be plenty
more. For example, a product of algebras is an algebra. Is a product
of free algebras also free? As a second example, do the algebras form
an exponential ideal: Is the algebra X â†’ A free if the algebra A is?

These questions are answered positively in the following module:

\begin{code}

import Lifting.ProductsOfFreeAlgebrasAreFree

\end{code}

So, at present, we have only *one* example of an algebra which is not
free in all toposes.

Speculative question. Is there a nice characterization of the type of
all algebra structures on Î©? We have two "extreme" ones, namely âˆƒ and âˆ€.
There must be plenty in between. What does the type of all of them
look like?
