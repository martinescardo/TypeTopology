Martin Escardo, Novemeber 2025.

Not all algebras of the partial-map classifier (aka lifting) monad are free.

In a boolean 1-topos, every algebra of the lifting monad is a free algebra.

John Sterling [1] asked whether this is the case in *all* toposes.

[1] https://doi.org/10.48550/arXiv.2312.17023

We show that it isn't.

For example, it fails in Johnstone's Topological topos. More
generally, we show that it fails in any topos in which the negation of
the principle of excluded middle holds.

The object Î© of truth values is an algebra in (at least) two ways,
with structure map â¨† = âˆƒ or â¨† = âˆ€.

In all toposes, the structure map â¨† = âˆƒ exhibits Î© as freely generated
by âŠ¤ : Î©.

In a boolean topos, the structure map â¨† = âˆ€ exhibits Î© as freely
generated by âŠ¥ : Î©.

Moreover, the converse is true. If the structure map â¨† = âˆ€ exhibits Î©
as freely generated by âŠ¥ : Î©, then the topos is boolean.

We may wonder whether, in an arbitrary topos, the object Î© with the
structure map â¨† = âˆ€ is freely generated by *any* object G of
generators.

We show that if this is the case, then

 1. G is a subsingleton/proposition/truth value,
 2. the double negation of the principle of excluded middle holds, and, moreover,
 3. G â‰ƒ (principle of excluded middle).

So the answer is negative.

The proof uses Higgs Involution Theorem.

\begin{code}

{-# OPTIONS --safe --without-K #-}

open import MLTT.Spartan
open import UF.FunExt
open import UF.Subsingletons

\end{code}

We work with an arbitrary give universe ğ“£, and assume function
extensionality and propostitional extensionality, which are available
in any 1-topos.

\begin{code}

module Lifting.AnAlgebraWhichIsNotAlwaysFree
        (ğ“£ : Universe)
        (fe : Fun-Ext)
        (pe : Prop-Ext)
       where

open import Higgs.InvolutionTheorem hiding (Î©)
open import Lifting.Algebras ğ“£
open import Lifting.Construction ğ“£
open import Lifting.EmbeddingDirectly ğ“£
open import Lifting.Identity ğ“£
open import Lifting.TwoAlgebrasOnOmega ğ“£ fe pe
open import UF.Base
open import UF.ClassicalLogic
open import UF.Embeddings
open import UF.Equiv
open import UF.Logic
open import UF.Sets
open import UF.SubtypeClassifier renaming (Î© to Î©-of-universe ;
                                           âŠ¥ to âŠ¥Î© ;
                                           âŠ¤ to âŠ¤Î©)
open import UF.SubtypeClassifier-Properties

open Implication fe renaming (Â¬â‚š_ to â‡_ ; Â¬Â¬â‚š_ to â‡â‡_ ; Â¬Â¬Â¬â‚š_ to â‡â‡â‡_)
open Universal fe

\end{code}

We work with a hypothetical set G of generators, and an inclusion of
generators Î¹, which will, by assumption, exhibit Î© with the structure
map â¨† = Î  as a free algebra.

\begin{code}

module _
        (G : ğ“£ Ì‡ )
        (G-is-set : is-set G)
        (Î¹ : G â†’ Î©)
       where

\end{code}

Before we assume anything under these hypotheses, we have the algebra
ğ“› G freely generated by G, with insertion of generators Î· : G â†’ ğ“› G,
and in particular a unique map h : ğ“› G â†’ Î© extending Î¹ along Î·.

\begin{code}

 open free-algebras-in-the-category-of-sets pe fe G G-is-set

 h : ğ“› G â†’ Î©
 h = ğ“›-extension (Î©-is-set fe pe) Î -algebra-on-Î© Î¹

 h-explicitly : h âˆ¼ Î» (P , Ï† , i) â†’ â±¯ p ê‰ P , Î¹ (Ï† p)
 h-explicitly = Î» _ â†’ refl

 h-is-hom : is-hom free Î -algebra-on-Î© h
 h-is-hom = ğ“›-extension-is-hom (Î©-is-set fe pe) Î -algebra-on-Î© Î¹

 h-extends-Î¹ : h âˆ˜ Î· âˆ¼ Î¹
 h-extends-Î¹ = ğ“›-extension-extends (Î©-is-set fe pe) Î -algebra-on-Î© Î¹

\end{code}

To achieve our objectives stated above, we will eventually assume that
h is an equivalence, so that Î© equipped with â¨† = Î  is also freely
generated by G.

We already know the following, but here is a simpler proof.

\begin{code}

 every-element-of-ğ“›-is-a-join : (l@(P , Ï† , i) : ğ“› G) â†’ l ï¼ â¨† i (Î» (_ : P) â†’ l)
 every-element-of-ğ“›-is-a-join l@(P , Ï† , i) =
  from-â‹ pe fe fe
   (((Î» (p : P) â†’ (p , p)) , prâ‚) , Î» (_ : P) â†’ refl)

\end{code}

In order to reach our conclusions, we need to know a convenient
definition of h.

\begin{code}

 useful-characterization-of-h : (l@(P , Ï† , i) : ğ“› G)
                              â†’ h l ï¼ ((P , i) â‡’ (â±¯ q ê‰ P , Î¹ (Ï† q)))
 useful-characterization-of-h l@(P , Ï† , i) =
   h l                           ï¼âŸ¨ ap h (every-element-of-ğ“›-is-a-join l) âŸ©
   h (â¨† i Î» _ â†’ l)              ï¼âŸ¨ h-is-hom P i (Î» _ â†’ l) âŸ©
   (P , i) â‡’ (â±¯ q ê‰ P , Î¹ (Ï† q)) âˆ

\end{code}

With this we easily conclude that h maps âŠ¥ to âŠ¤.

\begin{code}

 h-at-âŠ¥-is-âŠ¤ : h âŠ¥ ï¼ âŠ¤Î©
 h-at-âŠ¥-is-âŠ¤ =
  h âŠ¥                                  ï¼âŸ¨ useful-characterization-of-h âŠ¥ âŸ©
  âŠ¥Î© â‡’ (â±¯ q ê‰ ğŸ˜ , Î¹ (unique-from-ğŸ˜ q)) ï¼âŸ¨ I âŸ©
  âŠ¤Î©                                   âˆ
   where
    I = âŠ¥â‡’anything-is-âŠ¤ pe (â±¯ q ê‰ ğŸ˜ , Î¹ (unique-from-ğŸ˜ q))

\end{code}

Now we assume, for the sake of concluding the double negation of the
principle of excluded middle, that h is an equivalence.

\begin{code}

 module _ (h-is-equiv : is-equiv h) where

  ğ•™ : ğ“› G â‰ƒ Î©
  ğ•™ = h , h-is-equiv

  hâ»Â¹ : Î© â†’ ğ“› G
  hâ»Â¹ = âŒœ ğ•™ âŒâ»Â¹

\end{code}

With this assumption, we conclude that Î¹ : G â†’ Î© is constantly âŠ¥.

\begin{code}

  Î¹-is-contanstly-âŠ¥ : (g : G) â†’ Î¹ g ï¼ âŠ¥Î©
  Î¹-is-contanstly-âŠ¥ g = VIII
   where
    P : ğ“£ Ì‡
    P = Î¹ g holds

    i : is-prop P
    i = holds-is-prop (Î¹ g)

    Ï• : P â†’ ğ“› G
    Ï• _ = Î· g

    l : ğ“› G
    l = (P , (Î» (_ : P) â†’ g) , i)

    I = â¨† i Ï•                                                   ï¼âŸ¨ refl âŸ©
        ((P Ã— ğŸ™) , (Î» (_ : P Ã— ğŸ™) â†’ g) , Ã—-is-prop i ğŸ™-is-prop) ï¼âŸ¨ Iâ‚€ âŸ©
        l                                                       âˆ
         where
          Iâ‚€ = from-â‹ pe fe fe ((prâ‚ , (Î» p â†’ p , â‹†)) , (Î» (_ : P Ã— ğŸ™) â†’ refl))

    II : h (â¨† i Ï•) ï¼ (Î¹ g â‡’ h (Î· g))
    II = h-is-hom P i (Î» _ â†’ Î· g)

    III : h (â¨† i Ï•) ï¼ (Î¹ g â‡’ Î¹ g)
    III = transport (Î» - â†’ h (â¨† i Ï•) ï¼ Î¹ g â‡’ -) (h-extends-Î¹ g) II

    IV = h (â¨† i Ï•)   ï¼âŸ¨ III âŸ©
         (Î¹ g â‡’ Î¹ g) ï¼âŸ¨ anything-implies-itself-is-âŠ¤ pe (Î¹ g) âŸ©
         âŠ¤Î©          âˆ

    V = h (â¨† i Ï•) ï¼âŸ¨ IV âŸ©
        âŠ¤Î©        ï¼âŸ¨ h-at-âŠ¥-is-âŠ¤ â»Â¹ âŸ©
        h âŠ¥       âˆ

    VI : â¨† i Ï• ï¼ âŠ¥
    VI = equivs-are-lc h h-is-equiv V

    VII = l     ï¼âŸ¨ I â»Â¹ âŸ©
          â¨† i Ï• ï¼âŸ¨ VI âŸ©
          âŠ¥     âˆ

    VIII : Î¹ g ï¼ âŠ¥Î©
    VIII = to-Î©-ï¼ fe (ap is-defined VII)

\end{code}

And from this we conclude that the set G has at most one element.

\begin{code}

  G-is-prop : is-prop G
  G-is-prop gâ‚€ gâ‚ = embeddings-are-lc Î·
                     (Î·-is-embedding pe fe fe fe)
                     (equivs-are-lc h h-is-equiv I)
   where
    I = h (Î· gâ‚€) ï¼âŸ¨ h-extends-Î¹ gâ‚€ âŸ©
        Î¹ gâ‚€     ï¼âŸ¨ Î¹-is-contanstly-âŠ¥ gâ‚€ âŸ©
        âŠ¥Î©       ï¼âŸ¨ (Î¹-is-contanstly-âŠ¥ gâ‚)â»Â¹ âŸ©
        Î¹ gâ‚     ï¼âŸ¨ (h-extends-Î¹ gâ‚)â»Â¹ âŸ©
        h (Î· gâ‚) âˆ

\end{code}

It would be nice if we could conclude that G is pointed. All we can
conclude so far, however, is that G is nonempty.

\begin{code}

  G-is-nonempty : Â¬Â¬ G
  G-is-nonempty u = III
   where
    I : is-prop (ğ“› G)
    I (P , Ï† , i) (Q , Ïˆ , j) = from-â‹ pe fe fe
                                 (((Î» p â†’ ğŸ˜-elim (u (Ï† p))) ,
                                   (Î» q â†’ ğŸ˜-elim (u (Ïˆ q)))) ,
                                  (Î» p â†’ ğŸ˜-elim (u (Ï† p))))

    II : hâ»Â¹ âŠ¥Î© â‰  hâ»Â¹ âŠ¤Î©
    II e = âŠ¥-is-not-âŠ¤ (equivs-are-lc hâ»Â¹ âŒœ ğ•™ âŒâ»Â¹-is-equiv e)

    III : ğŸ˜
    III = II (I (hâ»Â¹ âŠ¥Î©) (hâ»Â¹ âŠ¤Î©))

\end{code}

We already have an equivalence hâ»Â¹ : Î© â†’ ğ“› G, but now we look at
another one, which is in essence the equivalence Î© â‰ƒ ğ“› ğŸ™. We don't
know that G â‰ƒ ğŸ™, but if we are given a point of G, we do know this, as we
already know that G is a proposition.

\begin{code}

  Î³ : G â†’ Î© â‰ƒ ğ“› G
  Î³ g = qinveq v (u , (Î» x â†’ refl) , vu)
   where
    u : ğ“› G â†’ Î©
    u (P , Ï† , i) = (P , i)

    v : Î© â†’ ğ“› G
    v (P , i) = P , (Î» z â†’ g) , i

    vu : v âˆ˜ u âˆ¼ id
    vu (P , Ï† , i) = from-â‹ pe fe fe ((id , id) , (Î» p â†’ G-is-prop g (Ï† p)))

\end{code}

Composing Î³ with h, we get an automorphism of Î©, with the following
explicit description and characterization.

\begin{code}

  Î´ : G â†’ Î© â‰ƒ Î©
  Î´ g = Î³ g â— ğ•™

  Î´-explicitly : (g : G) (p : Î©) â†’ âŒœ Î´ g âŒ p ï¼ (p â‡’ Î¹ g)
  Î´-explicitly g p = refl

  Î´-charac : (g : G) â†’ (p : Î©) â†’ âŒœ Î´ g âŒ p ï¼ (p â‡’ âŠ¥Î©)
  Î´-charac g p = transport
                  (Î» - â†’ âŒœ Î´ g âŒ p ï¼ (p â‡’ -))
                  (Î¹-is-contanstly-âŠ¥ g)
                  (Î´-explicitly g p)

\end{code}

That is, the map Î´ g is negation.

We now apply Higgs Involution Theorem to conclude that Î´ g is an
involution, as is any automorphism of Î©.

\begin{code}

  Î´-involutive : (g : G) â†’ involutive âŒœ Î´ g âŒ
  Î´-involutive g = automorphisms-of-Î©-are-involutive fe pe  âŒœ Î´ g âŒ âŒœ Î´ g âŒ-is-equiv

\end{code}

But the involutivity of Î´ g says that (p â†’ âŠ¥) â†’ âŠ¥ for all p, which
amounts to the principle of excluded middle.

\begin{code}

  G-pointed-gives-excluded-middle : G â†’ EM ğ“£
  G-pointed-gives-excluded-middle g = III
   where
    I : (p : Î©) â†’ ((p â‡’ âŠ¥Î©) â‡’ âŠ¥Î©) ï¼ p
    I p =
     (p â‡’ âŠ¥Î©) â‡’ âŠ¥Î©       ï¼âŸ¨ (Î´-charac g (p â‡’ âŠ¥Î©))â»Â¹ âŸ©
     âŒœ Î´ g âŒ (p â‡’ âŠ¥Î©)    ï¼âŸ¨ ap âŒœ Î´ g âŒ ((Î´-charac g p)â»Â¹) âŸ©
     âŒœ Î´ g âŒ (âŒœ Î´ g âŒ p) ï¼âŸ¨ Î´-involutive g p âŸ©
     p                   âˆ

    II : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ Â¬Â¬ P â†’ P
    II P i Ï• = idtofun _ _ (ap _holds (I (P , i))) Ï•'
     where
      Ï•' : (P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}
      Ï•' u = ğŸ˜-elim (Ï• (Î» p â†’ ğŸ˜-elim (u p)))

    III : EM ğ“£
    III = DNE-gives-EM fe II

\end{code}

Because G is nonempty, we conclude that Â¬Â¬ EM holds.

\begin{code}

  the-double-negation-of-excluded-middle-holds : Â¬Â¬ EM ğ“£
  the-double-negation-of-excluded-middle-holds =
    Â¬Â¬-functor G-pointed-gives-excluded-middle G-is-nonempty

\end{code}

We also have the following.

\begin{code}

  excluded-middle-gives-G-pointed : EM ğ“£ â†’ G
  excluded-middle-gives-G-pointed em = EM-gives-DNE em G G-is-prop G-is-nonempty

\end{code}

So now we know what the hypothetical set G of generators is. It is the
principle of excluded middle!

\begin{code}

  G-is-EM : G â‰ƒ EM ğ“£
  G-is-EM = logically-equivalent-props-are-equivalent
             G-is-prop
             (EM-is-prop (Î» ğ“¤ ğ“¥ â†’ fe {ğ“¤} {ğ“¥}))
             G-pointed-gives-excluded-middle
             excluded-middle-gives-G-pointed

\end{code}

This concludes the proof of all claims made above.

We originally developed some of the above ideas on paper, and then
more ideas here in Agda.

We conclude with some leftovers, which ended up not being used in the
proof of the above above claims, but which may be interesting in their
own right.

\begin{code}

  ğ”¾ : Î©
  ğ”¾ = (G , G-is-prop)

  Î·' : G â†’ ğ“› G
  Î·' g = G , (Î» _ â†’ g) , G-is-prop

  Î·-agrees-with-Î·' : Î· âˆ¼ Î·'
  Î·-agrees-with-Î·' g = from-â‹ pe fe fe (((Î» _ â†’ g) , (Î» _ â†’ â‹†)) , (Î» _ â†’ refl))

\end{code}

Now we can use G to produce an element of ğ“› G.

\begin{code}

  lâ‚€ : ğ“› G
  lâ‚€ = G , id , G-is-prop

  lâ‚€-is-not-âŠ¥ : lâ‚€ â‰  âŠ¥
  lâ‚€-is-not-âŠ¥ e = G-is-nonempty (Î» g â†’ ğŸ˜-elim (idtofun _ _ I g))
   where
    I : G ï¼ ğŸ˜
    I = ap is-defined e

  h-at-lâ‚€ : h lâ‚€ ï¼ (â±¯ g ê‰ G , Î¹ g)
  h-at-lâ‚€ = h-explicitly lâ‚€

  h-at-lâ‚€' : h lâ‚€ ï¼ âŠ¥Î©
  h-at-lâ‚€' = false-gives-equal-âŠ¥ pe fe _ (holds-is-prop _) I
   where
    I : Â¬ ((â±¯ g ê‰ G , Î¹ g) holds)
    I f = G-is-nonempty G-is-empty
     where
      G-is-empty : Â¬ G
      G-is-empty g = âŠ¥-doesnt-hold (transport _holds (Î¹-is-contanstly-âŠ¥ g) II)
       where
        II : Î¹ g holds
        II = f g

  lâ‚€-partial-charac : (g : G) â†’ lâ‚€ ï¼ Î· g
  lâ‚€-partial-charac g =
   equivs-are-lc h h-is-equiv (
    h lâ‚€    ï¼âŸ¨ h-at-lâ‚€' âŸ©
    âŠ¥Î©      ï¼âŸ¨ (Î¹-is-contanstly-âŠ¥ g)â»Â¹ âŸ©
    Î¹ g     ï¼âŸ¨ (h-extends-Î¹ g)â»Â¹ âŸ©
    h (Î· g) âˆ)

\end{code}
