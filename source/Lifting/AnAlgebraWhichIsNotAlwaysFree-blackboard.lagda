Martin Escardo, 7-8 November 2025, with revisions and additions to
the discussion 16, 20 and 24 November 2025.

----------------------------------------------------------------------------------
**Notice** This file is almost superseded by Lifting.AnAlgebraWhichIsNotAlwaysFree,
which has a stronger result with a simpler proof.

It is still interesting because (1) it has additional information, and
(2) it illustrates how we use TypeTopology as a blackboard to think
about mathematical ideas and develop them.
-----------------------------------------------------------------------------------

It is well known that in a boolean elementary (1-)topos, every algebra
of the lifting (aka partial-map classifier) monad is free, and the
proof is easy [1] [2].

We show that not all algebras are free in an arbitrary elementary topos.

Two examples where the failure occurs are Johnstone's Topological
Topos and Hyland's Effective Topos. More generally, we show that this
is the case in any topos in which the negation of the principle of
excluded middle holds.

The object Î© of truth values is an algebra in (at least) two ways,
with structure map â¨† = âˆƒ and â¨† = âˆ€.

In all toposes, the structure map â¨† = âˆƒ exhibits Î© as freely generated
by âŠ¤ : Î©.

In a boolean topos, the structure map â¨† = âˆ€ exhibits Î© as freely
generated by âŠ¥ : Î©.

Moreover, the converse is true. If the structure map â¨† = âˆ€ exhibits Î©
as freely generated by âŠ¥ : Î©, then the topos is boolean.

We may wonder whether, in an arbitrary topos, the object Î© with the
structure map â¨† = âˆ€ is freely generated by *any* object G of
generators.

We show that if this is the case, then

 1. G is a non-empty subsingleton/proposition/truth value,
 2. the insertion of generators Î¹ : G â†’ Î© is constantly âŠ¥,
 3. the double negation of the principle of excluded middle holds, and, moreover,
 4. G â‰ƒ (principle of excluded middle).

The proof uses Higgs Involution Theorem.

TODO. But in principle it may still be the case that if Î© equipped
with âˆ€ is freely generated by a set of generators G, then the
principle of excluded middle holds, in which case (3) above reduces to
G â‰ƒ ğŸ™. We leave this as an open problem. (Added 24th November 2025. We
answer the question positively, with a simpler proof, which in
particular doesn't rely on Higgs Involution Theorem.)

Discussion added 16 November 2025.

Jon Sterling [1] previously conjectured that the same is the case for
the lifting monad in the category of dcpos [3], namely that there are some
toposes in which there is an algebra of the lifting monad in the
category of dcpos which is not free.

We haven't (yet) formalized this here, but we offer an argument to
prove Sterling's conjecture, based on the above claims (which are
formalized below).

Anders Kock [2] proved that any algebra in the category of sets is
bounded-complete (every upper bounded set has a least upper bound).

Because the lifting algebra Î© with structure map âˆ€ has a largest
element, namely âŠ¥, it is a sup-lattice, and, in particular, directed
complete.

Regarding continuity, the structure map is always supremum (after
Kock), and suprema formation always preserve suprema, including
directed ones.

Hence the answer for the category of sets also gives an answer for the
category of dcpos in any elementary topos.

So the above discussion settles Sterling's conjecture positively, by
providing an example of a dcpo lifting algebra which is not always
free.

TODO. It would be good to formalize this in TypeTopology.

It is also worth citing Kock's paper [3], which in particular shows
that, in the category of posets, structure maps are adjoint to units
of the monad, and hence are unique when they exist. What happens here
is that Î© has at least two structure maps (namely âˆƒ and âˆ€) and hence
two different orders according to [2]. In particular, Î© is a dcpo in
two different ways, each one with a unique structure map making it
into an algebra, both in the category of sets and in the category of
dcpos.

[1] Jon Sterling. Tensorial structure of the lifting doctrine in
    constructive domain theory. Originally 28 Dec 2023, last revised 30
    Jan 2025. https://doi.org/10.48550/arXiv.2312.17023

[2] Anders Kock. Algebras for the partial-map classifier monad. In:
    Carboni, A., Pedicchio, M.C., Rosolini, G. (eds) Category
    Theory. LNM, vol 1488.
    https://doi.org/10.1007/BFb0084225
    https://tildeweb.au.dk/au76680/jonna5.pdf

[3] Anders Kock. The constructive lift monad.
    BRICS Report Series (Aarhus), ISSN 0909-0878 (1995)
    http://tildeweb.au.dk/au76680/CLM.pdf

\begin{code}

{-# OPTIONS --safe --without-K #-}

open import MLTT.Spartan
open import UF.FunExt
open import UF.Subsingletons

\end{code}

We work with an arbitrary universe ğ“£, and assume function
extensionality and propositional extensionality, which are available
in any 1-topos.

\begin{code}

module Lifting.AnAlgebraWhichIsNotAlwaysFree-blackboard
        (ğ“£ : Universe)
        (fe : Fun-Ext)
        (pe : Prop-Ext)
       where

private
 fe' : FunExt
 fe' ğ“¤ ğ“¥ = fe {ğ“¤} {ğ“¥}

 ğ“£âº = ğ“£ âº

open import Higgs.InvolutionTheorem hiding (Î©)
open import Lifting.Algebras ğ“£
open import Lifting.Construction ğ“£
open import Lifting.EmbeddingDirectly ğ“£
open import Lifting.Identity ğ“£
open import Lifting.TwoAlgebrasOnOmega ğ“£ fe pe renaming (Î -alg-on-Î© to Î©âˆ€)
open import UF.ClassicalLogic
open import UF.DiscreteAndSeparated
open import UF.Embeddings
open import UF.Equiv
open import UF.Logic
open import UF.Sets
open import UF.Subsingletons-FunExt
open import UF.SubtypeClassifier renaming (Î© to Î©-of-universe ;
                                           âŠ¥ to âŠ¥Î© ;
                                           âŠ¤ to âŠ¤Î©)
open import UF.SubtypeClassifier-Properties

open Implication fe renaming (Â¬â‚š_ to â‡_ ; Â¬Â¬â‚š_ to â‡â‡_)
open Universal fe

private
 Î© : ğ“£âº Ì‡
 Î© = Î©-of-universe ğ“£

\end{code}

We work with a hypothetical set G of generators, and an inclusion of
generators Î¹, which will, by assumption, exhibit Î© with the structure
map â¨† = âˆ€ as a free algebra.

\begin{code}

module main-results
        (G : ğ“£ Ì‡ )
        (G-is-set : is-set G)
        (Î¹ : G â†’ Î©)
       where

\end{code}

To achieve our objectives stated above, we will soon assume that
Î© equipped with the structure map âˆ€ is indeed freely generated by G
with insertion of generators Î¹, which implies that h is an
equivalence. But we can prove a few things before we assume that.

We have the algebra ğ“› G freely generated by G, with insertion of
generators Î· : G â†’ ğ“› G, and in particular a unique algebra
homomorphism h : ğ“› G â†’ Î© extending Î¹ along Î·.

       Î·
  G â”€â”€â”€â”€â”€â”€â”€â†’ ğ“› G
   â•²          â”‚
    â•²         â”‚
     â•²        â”‚
    Î¹ â•²    h  â”‚
       â•²      â”‚
        â•²     â”‚
         â•²    â”‚
          â•²   â†“
           â˜  Î©.

\begin{code}

 open free-algebras-in-the-category-of-sets pe fe G G-is-set

 h : ğ“› G â†’ Î©
 h = ğ“›-extension (Î©-is-set fe pe) Î©âˆ€ Î¹

 h-explicitly : h âˆ¼ Î» (P , Ï† , i) â†’ â±¯ a ê‰ P , Î¹ (Ï† a)
 h-explicitly _ = refl

 ğ“›G : ğ“›-alg (ğ“› G)
 ğ“›G = canonical-free-algebra

 h-is-hom : is-hom ğ“›G Î©âˆ€ h
 h-is-hom = ğ“›-extension-is-hom (Î©-is-set fe pe) Î©âˆ€ Î¹

 h-extends-Î¹ : h âˆ˜ Î· âˆ¼ Î¹
 h-extends-Î¹ = ğ“›-extension-extends (Î©-is-set fe pe) Î©âˆ€ Î¹

\end{code}

We already know the following, but here is a simpler proof.

\begin{code}

 every-element-of-ğ“›-is-a-join : (l@(P , Ï† , i) : ğ“› G) â†’ l ï¼ â¨† i (Î» (_ : P) â†’ l)
 every-element-of-ğ“›-is-a-join l@(P , Ï† , i) =
  from-â‹ pe fe fe
   (((Î» (a : P) â†’ (a , a)) , prâ‚) , Î» (_ : P) â†’ refl)

\end{code}

In order to reach our conclusions, we need to know a convenient
definition of h.

\begin{code}

 useful-characterization-of-h : (l@(P , Ï† , i) : ğ“› G)
                              â†’ h l ï¼ ((P , i) â‡’ (â±¯ p ê‰ P , Î¹ (Ï† p)))
 useful-characterization-of-h l@(P , Ï† , i) =
  h l                           ï¼âŸ¨ ap h (every-element-of-ğ“›-is-a-join l) âŸ©
  h (â¨† i (Î» _ â†’ l))            ï¼âŸ¨ h-is-hom P i (Î» _ â†’ l) âŸ©
  (P , i) â‡’ (â±¯ p ê‰ P , Î¹ (Ï† p)) âˆ

\end{code}

With this we easily conclude that h maps âŠ¥ to âŠ¤.

\begin{code}

 h-at-âŠ¥-is-âŠ¤ : h âŠ¥ ï¼ âŠ¤Î©
 h-at-âŠ¥-is-âŠ¤ =
  h âŠ¥                                  ï¼âŸ¨ useful-characterization-of-h âŠ¥ âŸ©
  âŠ¥Î© â‡’ (â±¯ q ê‰ ğŸ˜ , Î¹ (unique-from-ğŸ˜ q)) ï¼âŸ¨ I âŸ©
  âŠ¤Î©                                   âˆ
   where
    I = âŠ¥â‡’anything-is-âŠ¤ pe (â±¯ q ê‰ ğŸ˜ , Î¹ (unique-from-ğŸ˜ q))

\end{code}

Notice that we didn't need to assume that Î© equipped with the
structure map âˆ€ is freely generated in order to conclude the above.

Now we assume, for the sake of eventually concluding that the double
negation of the principle of excluded middle holds, that Î© equipped
with the structure map âˆ€ is freely generated by G with insertion of
generators Î¹.

\begin{code}

 module assumption
         (Î©âˆ€-is-free : is-free-ğ“›-alg Î©âˆ€ G Î¹)
        where

\end{code}

All we need to reach our desired conclusions is that the map h is an
equivalence, and so our assumption is slightly stronger than needed.

To show that h is an equivalence from this assumption, consider the
diagram below, where ğ“› G is freely generated by G with insertion of
generators Î·, and Î© is freely generated by G with insertion of
generators Î¹. So the conclusion is a standard categorical argument.

       Î·
  G â”€â”€â”€â”€â”€â”€â”€â†’ ğ“› G
   â•²         â”‚ â†‘
    â•²        â”‚ â”‚
     â•²       â”‚ â”‚
    Î¹ â•²    h â”‚ â”‚ hâ»Â¹
       â•²     â”‚ â”‚
        â•²    â”‚ â”‚
         â•²   â”‚ â”‚
          â•²  â†“ â”‚
           â˜  Î©.

Both ğ“› G and Î© satisfy the universal property indicated in the above
diagram, with h being the unique homomorphism extending Î¹ along Î·, and
hâ»Â¹ being the unique homomorphism extending Î· along Î¹.

\begin{code}

  module E = free-algebra-eliminators
              Î©âˆ€ G Î¹ Î©âˆ€-is-free (ğ“›-is-set fe fe pe G-is-set)
              ğ“›G Î·

  hâ»Â¹ : Î© â†’ ğ“› G
  hâ»Â¹ = E.unique-hom

  h-is-equiv : is-equiv h
  h-is-equiv = qinvs-are-equivs h (hâ»Â¹ , III , IV)
   where
    hâ»Â¹-is-hom : is-hom Î©âˆ€ ğ“›G hâ»Â¹
    hâ»Â¹-is-hom = E.unique-hom-is-hom

    hâ»Â¹-extends-Î· : hâ»Â¹ âˆ˜ Î¹ âˆ¼ Î·
    hâ»Â¹-extends-Î· = E.unique-hom-is-extension

    I : is-hom ğ“›G ğ“›G (hâ»Â¹ âˆ˜ h)
    I = âˆ˜-is-hom ğ“›G Î©âˆ€ ğ“›G h hâ»Â¹ h-is-hom hâ»Â¹-is-hom

    II : is-hom Î©âˆ€ Î©âˆ€ (h âˆ˜ hâ»Â¹)
    II = âˆ˜-is-hom Î©âˆ€ ğ“›G Î©âˆ€ hâ»Â¹ h hâ»Â¹-is-hom h-is-hom

    III : hâ»Â¹ âˆ˜ h âˆ¼ id
    III = at-most-one-extending-hom'
           (hâ»Â¹ âˆ˜ h , I)
           (id , id-is-hom ğ“›G)
           (Î» l â†’ hâ»Â¹ (h (Î· l)) ï¼âŸ¨ ap hâ»Â¹ (h-extends-Î¹ l) âŸ©
                  hâ»Â¹ (Î¹ l)     ï¼âŸ¨ hâ»Â¹-extends-Î· l âŸ©
                  Î· l           âˆ)
           (Î» _ â†’ refl)
     where
      open free-algebra-eliminators ğ“›G G Î·
           ğ“›-is-free (ğ“›-is-set fe fe pe G-is-set) ğ“›G Î·

    IV : h âˆ˜ hâ»Â¹ âˆ¼ id
    IV = at-most-one-extending-hom'
          (h âˆ˜ hâ»Â¹ , II)
          (id , id-is-hom Î©âˆ€)
          (Î» p â†’ h (hâ»Â¹ (Î¹ p)) ï¼âŸ¨ ap h (hâ»Â¹-extends-Î· p) âŸ©
                 h (Î· p)       ï¼âŸ¨ h-extends-Î¹ p âŸ©
                 Î¹ p           âˆ)
          (Î» _ â†’ refl)
     where
      open free-algebra-eliminators
            Î©âˆ€ G Î¹ Î©âˆ€-is-free (Î©-is-set fe pe) Î©âˆ€ Î¹

  ğ•™ : ğ“› G â‰ƒ Î©
  ğ•™ = h , h-is-equiv

\end{code}

Using this, we in turn conclude that our assumed map Î¹ : G â†’ Î© is
constantly âŠ¥.

\begin{code}

  Î¹-is-constantly-âŠ¥ : (g : G) â†’ Î¹ g ï¼ âŠ¥Î©
  Î¹-is-constantly-âŠ¥ g = III
   where
    P : ğ“£ Ì‡
    P = Î¹ g holds

    i : is-prop P
    i = holds-is-prop (Î¹ g)

    Ï• : P â†’ ğ“› G
    Ï• _ = Î· g

    l : ğ“› G
    l = (P , (Î» (_ : P) â†’ g) , i)

    I = h (â¨† i Ï•)     ï¼âŸ¨ h-is-hom P i Ï• âŸ©
        Î¹ g â‡’ h (Î· g) ï¼âŸ¨ ap (Î¹ g â‡’_) (h-extends-Î¹ g) âŸ©
        Î¹ g â‡’ Î¹ g     ï¼âŸ¨ anything-implies-itself-is-âŠ¤ pe (Î¹ g) âŸ©
        âŠ¤Î©            ï¼âŸ¨ h-at-âŠ¥-is-âŠ¤ â»Â¹ âŸ©
        h âŠ¥           âˆ

    II = l      ï¼âŸ¨ from-â‹ pe fe fe (((Î» p â†’ p , â‹†) , prâ‚) , (Î» _ â†’ refl)) âŸ©
         â¨† i Ï•  ï¼âŸ¨ equivs-are-lc h h-is-equiv I âŸ©
         âŠ¥      âˆ

    III : Î¹ g ï¼ âŠ¥Î©
    III = to-Î©-ï¼ fe (ap is-defined II)

\end{code}

And from this we conclude that the set G has at most one element.

\begin{code}

  G-is-prop : is-prop G
  G-is-prop gâ‚€ gâ‚ = II
   where
    I = h (Î· gâ‚€) ï¼âŸ¨ h-extends-Î¹ gâ‚€ âŸ©
        Î¹ gâ‚€     ï¼âŸ¨ Î¹-is-constantly-âŠ¥ gâ‚€ âŸ©
        âŠ¥Î©       ï¼âŸ¨ (Î¹-is-constantly-âŠ¥ gâ‚)â»Â¹ âŸ©
        Î¹ gâ‚     ï¼âŸ¨ (h-extends-Î¹ gâ‚)â»Â¹ âŸ©
        h (Î· gâ‚) âˆ

    II : gâ‚€ ï¼ gâ‚
    II = embeddings-are-lc Î·
          (Î·-is-embedding pe fe fe fe)
          (equivs-are-lc h h-is-equiv I)

\end{code}

It would be nice if we could conclude that G is pointed. All we can
conclude so far, however, is that G is nonempty.

\begin{code}

  G-is-nonempty : Â¬Â¬ G
  G-is-nonempty u = III
   where
    I : is-prop (ğ“› G)
    I (P , Ï† , i) (Q , Ïˆ , j) = from-â‹ pe fe fe
                                 (((Î» p â†’ ğŸ˜-elim (u (Ï† p))) ,
                                   (Î» q â†’ ğŸ˜-elim (u (Ïˆ q)))) ,
                                  (Î» p â†’ ğŸ˜-elim (u (Ï† p))))

    II : hâ»Â¹ âŠ¥Î© â‰  hâ»Â¹ âŠ¤Î©
    II e = âŠ¥-is-not-âŠ¤ (equivs-are-lc hâ»Â¹ âŒœ ğ•™ âŒâ»Â¹-is-equiv e)

    III : ğŸ˜
    III = II (I (hâ»Â¹ âŠ¥Î©) (hâ»Â¹ âŠ¤Î©))

\end{code}

We already have an equivalence hâ»Â¹ : Î© â†’ ğ“› G, but now we look at
another one, which is in essence the canonical equivalence Î© â‰ƒ ğ“› ğŸ™. We
don't know that G â‰ƒ ğŸ™, but if we are given a point of G, we do know
this, as we already know that G is a proposition.

\begin{code}

  Î³ : G â†’ Î© â‰ƒ ğ“› G
  Î³ g = qinveq v (u , (Î» (_ : Î©) â†’ refl) , vu)
   where
    u : ğ“› G â†’ Î©
    u (P , Ï† , i) = (P , i)

    v : Î© â†’ ğ“› G
    v (P , i) = P , (Î» _ â†’ g) , i

    vu : v âˆ˜ u âˆ¼ id
    vu (P , Ï† , i) = from-â‹ pe fe fe ((id , id) , (Î» p â†’ G-is-prop g (Ï† p)))

\end{code}

Composing Î³ with h, we get an automorphism of Î©, with the following
explicit description and characterization.

\begin{code}

  Î´ : G â†’ Î© â‰ƒ Î©
  Î´ g = Î³ g â— ğ•™

  Î´-explicitly : (g : G) (p : Î©) â†’ âŒœ Î´ g âŒ p ï¼ (p â‡’ Î¹ g)
  Î´-explicitly g p = refl

  Î´-charac : (g : G) â†’ (p : Î©) â†’ âŒœ Î´ g âŒ p ï¼ â‡ p
  Î´-charac g p = transport
                  (Î» - â†’ âŒœ Î´ g âŒ p ï¼ (p â‡’ -))
                  (Î¹-is-constantly-âŠ¥ g)
                  (Î´-explicitly g p)

\end{code}

That is, the map Î´ g is negation.

We now apply Higgs Involution Theorem to conclude that Î´ g is an
involution, as is any automorphism of Î©.

\begin{code}

  Î´-involutive : (g : G) â†’ involutive âŒœ Î´ g âŒ
  Î´-involutive g = automorphisms-of-Î©-are-involutive fe pe  âŒœ Î´ g âŒ âŒœ Î´ g âŒ-is-equiv

\end{code}

But the involutivity of Î´ g says that (â‡â‡ p) = p for all p, which
amounts to the principle of excluded middle.

\begin{code}

  G-pointed-gives-excluded-middle : G â†’ EM ğ“£
  G-pointed-gives-excluded-middle g = III
   where
    I : (p : Î©) â†’ (â‡â‡ p) ï¼ p
    I p =
     â‡â‡ p                ï¼âŸ¨ (Î´-charac g (p â‡’ âŠ¥Î©))â»Â¹ âŸ©
     âŒœ Î´ g âŒ (â‡ p)       ï¼âŸ¨ ap âŒœ Î´ g âŒ ((Î´-charac g p)â»Â¹) âŸ©
     âŒœ Î´ g âŒ (âŒœ Î´ g âŒ p) ï¼âŸ¨ Î´-involutive g p âŸ©
     p                   âˆ

    II : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ Â¬Â¬ P â†’ P
    II P i Ï• = idtofun _ _ (ap _holds (I (P , i))) Ï•'
     where
      Ï•' : (P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}
      Ï•' u = ğŸ˜-elim (Ï• (Î» p â†’ ğŸ˜-elim (u p)))

    III : (P : Set ğ“£) â†’ is-prop P â†’  P + Â¬ P
    III = DNE-gives-EM fe II

\end{code}

Because G is nonempty, we conclude that Â¬Â¬ EM holds.

\begin{code}

  the-double-negation-of-excluded-middle-holds : Â¬Â¬ EM ğ“£
  the-double-negation-of-excluded-middle-holds =
   Â¬Â¬-functor G-pointed-gives-excluded-middle G-is-nonempty

\end{code}

We also have the following.

\begin{code}

  excluded-middle-gives-G-pointed : EM ğ“£ â†’ G
  excluded-middle-gives-G-pointed em = EM-gives-DNE em G G-is-prop G-is-nonempty

\end{code}

So now we know what the hypothetical set G of generators is. It is the
principle of excluded middle!

\begin{code}

  G-is-EM : G â‰ƒ EM ğ“£
  G-is-EM = logically-equivalent-props-are-equivalent
             G-is-prop
             (EM-is-prop fe')
             G-pointed-gives-excluded-middle
             excluded-middle-gives-G-pointed

\end{code}

This concludes the proof of all claims made above.

We originally developed some of the above ideas on paper, and then
more ideas here in Agda. Before summarizing explicitly our main result
and corollary, given below, we record some leftovers , which ended up
not being used in the proof of the above above claims, but which may
be interesting in their own right, and may be useful (or not) for
answering the questions below.

\begin{code}

  ğ”¾ : Î©
  ğ”¾ = (G , G-is-prop)

  Î·' : G â†’ ğ“› G
  Î·' g = G , (Î» _ â†’ g) , G-is-prop

  Î·-agrees-with-Î·' : Î· âˆ¼ Î·'
  Î·-agrees-with-Î·' g = from-â‹ pe fe fe (((Î» _ â†’ g) , (Î» _ â†’ â‹†)) , (Î» _ â†’ refl))

\end{code}

Now we can use G to produce an element of ğ“› G.

\begin{code}

  lâ‚€ : ğ“› G
  lâ‚€ = G , id , G-is-prop

  h-at-lâ‚€-explicitly : h lâ‚€ ï¼ âˆ€[ê‰]-syntax (lâ‚€ .prâ‚) (Î» a â†’ Î¹ (lâ‚€ .prâ‚‚ .prâ‚ a))
  h-at-lâ‚€-explicitly = h-explicitly lâ‚€

  lâ‚€-is-not-âŠ¥ : lâ‚€ â‰  âŠ¥
  lâ‚€-is-not-âŠ¥ e = G-is-nonempty (Î» g â†’ ğŸ˜-elim (idtofun _ _ I g))
   where
    I : G ï¼ ğŸ˜
    I = ap is-defined e

  h-at-lâ‚€ : h lâ‚€ ï¼ (â±¯ g ê‰ G , Î¹ g)
  h-at-lâ‚€ = h-explicitly lâ‚€

  h-at-lâ‚€' : h lâ‚€ ï¼ âŠ¥Î©
  h-at-lâ‚€' = false-gives-equal-âŠ¥ pe fe _ (holds-is-prop _) I
   where
    I : Â¬ ((â±¯ g ê‰ G , Î¹ g) holds)
    I f = G-is-nonempty G-is-empty
     where
      G-is-empty : Â¬ G
      G-is-empty g = âŠ¥-doesnt-hold (transport _holds (Î¹-is-constantly-âŠ¥ g) II)
       where
        II : Î¹ g holds
        II = f g

  lâ‚€-partial-charac : (g : G) â†’ lâ‚€ ï¼ Î· g
  lâ‚€-partial-charac g =
   equivs-are-lc h h-is-equiv
    (h lâ‚€    ï¼âŸ¨ h-at-lâ‚€' âŸ©
     âŠ¥Î©      ï¼âŸ¨ (Î¹-is-constantly-âŠ¥ g)â»Â¹ âŸ©
     Î¹ g     ï¼âŸ¨ (h-extends-Î¹ g)â»Â¹ âŸ©
     h (Î· g) âˆ)

\end{code}

We summarize the main results of this file as follows.

\begin{code}

consequences-of-Î©âˆ€-being-freely-generated
 : (G : ğ“£ Ì‡ )
   (G-is-set : is-set G)
   (Î¹ : G â†’ Î©)
   (Î©âˆ€-is-free : is-free-ğ“›-alg Î©âˆ€ G Î¹)
 â†’  Â¬Â¬ EM ğ“£
 Ã—  is-prop G
 Ã—  Â¬ is-empty G
 Ã—  ((g : G) â†’ Î¹ g ï¼ âŠ¥Î©)
 Ã—  (G â‰ƒ EM ğ“£)
consequences-of-Î©âˆ€-being-freely-generated G G-is-set Î¹ Î©âˆ€-is-free
 = the-double-negation-of-excluded-middle-holds ,
   G-is-prop ,
   G-is-nonempty ,
   Î¹-is-constantly-âŠ¥ ,
   G-is-EM
 where
  open main-results G G-is-set Î¹
  open assumption Î©âˆ€-is-free

\end{code}

Notice that there is some redundancy in the conclusions.

In the introduction to this file, we claimed that if Î© equipped with
the lifting structure âˆ€ is freely generated by âŠ¥ : Î©, then the topos
is boolean. This is a particular case of the above development.

\begin{code}

corollary : is-free-ğ“›-alg Î©âˆ€  ğŸ™ (Î» â‹† â†’ âŠ¥Î©) â†’ EM ğ“£
corollary Î©âˆ€-is-freely-generated-by-âŠ¥
 = G-pointed-gives-excluded-middle â‹†
 where
  open main-results ğŸ™ ğŸ™-is-set (Î» â‹† â†’ âŠ¥Î©)
  open assumption Î©âˆ€-is-freely-generated-by-âŠ¥

\end{code}

Discussion. For interpreting the above results in a 1-topos, notice
that toposes validate propositional resizing, and so the two universes
ğ“£ and ğ“£âº collapse to a single one, and in fact no universe is needed,
as the only reason ğ“£âº arises is that both Î© and ğ“› G live in ğ“£âº, rather
than ğ“£, in the absence of propositional resizing. However, Agda forces
us to work with at least one universe, as opposed to MLTT, although
this is inessential.

We conclude with some questions, under the following assumptions:

\begin{code}

module _
        (G : ğ“£ Ì‡ )
        (G-is-set : is-set G)
        (Î¹ : G â†’ Î©)
       where

 private
  Î©âˆ€-is-free = is-free-ğ“›-alg Î©âˆ€ G Î¹

\end{code}

The first question is whether our result is tight.

\begin{code}

 Questionâ‚€ = Â¬Â¬ EM ğ“£
           â†’ is-free-ğ“›-alg Î©âˆ€ G Î¹

 Questionâ‚€-variationâ‚€ = Â¬Â¬ EM ğ“£
                      â†’ G â‰ƒ EM ğ“£
                      â†’ is-free-ğ“›-alg Î©âˆ€ G Î¹

 Questionâ‚€-variationâ‚ = Â¬Â¬ EM ğ“£
                      â†’ G â‰ƒ EM ğ“£
                      â†’ ((g : G) â†’ Î¹ g ï¼ âŠ¥Î©)
                      â†’ is-free-ğ“›-alg Î©âˆ€ G Î¹
\end{code}

The second question is whether our result can be improved as follows.

\begin{code}

 Questionâ‚ = is-free-ğ“›-alg Î©âˆ€ G Î¹
           â†’ EM ğ“£

\end{code}

That is, any topos in which Î©âˆ€ is free would be necessarily boolean.
(Added 24th November 2025. We answer Questionâ‚ positively below.)

\begin{code}

 of-course : Questionâ‚€ â†’ Questionâ‚ â†’ (Â¬Â¬ EM ğ“£ â†’ EM ğ“£)
 of-course qâ‚€ qâ‚ nnem = qâ‚ (qâ‚€ nnem)

\end{code}

But there are toposes in which Â¬Â¬ EM holds but EM fails (an example,
communicated to me by Andrew Swan, is the Sierpinski topos (*)), so the
two questions can't have a positive answer simultaneously in an
arbitrary topos.

(*) Luna Strah provided the following proof: EM in the topos of
sheaves over a topological space is the interior of the intersection
of all dense opens, which is the dense open set {1} for the Sierpinski
space, where 1 is the top point in the specialization order, and so
Â¬Â¬ EM is validated in the Sierpinski topos, but EM is not.

Added 21st November 2025.

Regarding (4) above, namely

 4. G â‰ƒ (principle of excluded middle),

Anders Kock proved in [3] above that if a lifting algebra is free,
then it is freely generated by its positive elements.

For Î© equipped with âˆ€ as its lifting structure, an element q : Î© is
positive iff ((p â†’ q) â†’ q) â†’ p for all p : Î©.

It follows from this that:

(i) âŠ¥ is positive iff the principle of excluded middle (EM) holds.

(ii) If q : Î© is positive then q ï¼ âŠ¥.

(iii) The set of positive elements is a subsingleton, which is
      inhabited iff EM holds, that is,

      (set of positive elements) â‰ƒ (principle of excluded middle).

Added 24th November. Here is this proof written in Agda.

\begin{code}

Î©âˆ€-positivity-characâ†’ : (q : Î©)
                      â†’ is-positive Î©âˆ€ q
                      â†’ ((p : Î©) â†’ (((p â‡’ q) â‡’ q) â‡’ p) holds)
Î©âˆ€-positivity-characâ†’ q@(Q , Q-is-prop) q-is-pos p@(P , P-is-prop) = III
 where
  I : ((P â†’ Q) , _) ï¼ q â†’ P
  I = q-is-pos P P-is-prop

  II : ((P â†’ Q) â†’ Q) â†’ (P â†’ Q) ï¼ Q
  II Ï† = pe (Î -is-prop fe (Î» _ â†’ Q-is-prop))
             Q-is-prop
             Ï†
             (Î» (b : Q) (a : P) â†’ b)

  III : ((P â†’ Q) â†’ Q) â†’ P
  III Ï† = I (to-Î©-ï¼ fe (II Ï†))

Î©âˆ€-positivity-characâ† : (q : Î©)
                      â†’ ((p : Î©) â†’ (((p â‡’ q) â‡’ q) â‡’ p) holds)
                      â†’ is-positive Î©âˆ€ q
Î©âˆ€-positivity-characâ† q@(Q , Q-is-prop) Ï• P P-is-prop e = II
 where
  I : (P â†’ Q) â†’ Q
  I = idtofun (P â†’ Q) Q (ap prâ‚ e)

  II : P
  II = Ï• (P , P-is-prop) I

\end{code}

In the next two proofs there is an annoying universe conversion, to
translate between

Ï•' : (P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}

and Â¬Â¬ P, which amounts to

Ï• : (P â†’ ğŸ˜ {ğ“¤â‚€}) â†’ ğŸ˜ {ğ“¤â‚€}.

\begin{code}

âŠ¥-âˆ€-positive-gives-EM : is-positive Î©âˆ€ âŠ¥Î© â†’ EM ğ“£
âŠ¥-âˆ€-positive-gives-EM âŠ¥-is-pos = III
 where
  I : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ ((P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}) â†’ P
  I P P-is-prop = Î©âˆ€-positivity-characâ†’ âŠ¥Î© âŠ¥-is-pos (P , P-is-prop)

  II : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ ((P â†’ ğŸ˜ {ğ“¤â‚€}) â†’ ğŸ˜ {ğ“¤â‚€}) â†’ P
  II P P-is-prop Ï• = I P P-is-prop Ï•'
   where
    Ï•' : (P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}
    Ï•' = Î» (u : P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜-elim (Ï• (Î» (a : P) â†’ ğŸ˜-elim (u a)))

  III : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ P + Â¬ P
  III = DNE-gives-EM fe II

EM-gives-âŠ¥-âˆ€-positive : EM ğ“£ â†’ is-positive Î©âˆ€ âŠ¥Î©
EM-gives-âŠ¥-âˆ€-positive em = III
 where
  I : (P : ğ“£ Ì‡ ) â†’ is-prop P â†’ ((P â†’ ğŸ˜ {ğ“¤â‚€}) â†’ ğŸ˜ {ğ“¤â‚€}) â†’ P
  I = EM-gives-DNE em

  II : (p@(P , P-is-prop) : Î©) â†’ ((P â†’ ğŸ˜ {ğ“£}) â†’ ğŸ˜ {ğ“£}) â†’ P
  II (P , P-is-prop) Ï•' = I P P-is-prop Ï•
   where
    Ï• : (P â†’ ğŸ˜ {ğ“¤â‚€}) â†’ ğŸ˜ {ğ“¤â‚€}
    Ï• = Î» (u : P â†’ ğŸ˜ {ğ“¤â‚€}) â†’ ğŸ˜-elim (Ï•' (Î» (a : P) â†’ ğŸ˜-elim (u a)))

  III : is-positive Î©âˆ€ âŠ¥Î©
  III = Î©âˆ€-positivity-characâ† âŠ¥Î© II

\end{code}

For the following we take p ï¼ âŠ¥Î© in the characterization of the
positivity.

\begin{code}

âˆ€-positive-gives-equal-âŠ¥ : (q : Î©) â†’ is-positive Î©âˆ€ q â†’ q ï¼ âŠ¥Î©
âˆ€-positive-gives-equal-âŠ¥ q@(Q , Q-is-prop) q-is-pos = II
 where
  I : Â¬ Q
  I b = ğŸ˜-elim Iâ‚
   where
    Iâ‚ : ğŸ˜ {ğ“£}
    Iâ‚ = Î©âˆ€-positivity-characâ†’ q q-is-pos âŠ¥Î© (Î» (u : ğŸ˜ â†’ Q) â†’ b)

  II : q ï¼ âŠ¥Î©
  II = fails-gives-equal-âŠ¥ pe fe q I

\end{code}

Hence the positive elements form a subsingleton.

\begin{code}

the-âˆ€-positive-props-form-a-prop : is-prop (Î£ q ê‰ Î© , is-positive Î©âˆ€ q)
the-âˆ€-positive-props-form-a-prop (q , q-is-pos) (q' , q'-is-pos) =
 to-subtype-ï¼
  (being-positive-is-prop fe Î©âˆ€)
  (q  ï¼âŸ¨ âˆ€-positive-gives-equal-âŠ¥ q q-is-pos âŸ©
   âŠ¥Î© ï¼âŸ¨ (âˆ€-positive-gives-equal-âŠ¥ q' q'-is-pos)â»Â¹ âŸ©
   q' âˆ)

\end{code}

And, moreover, any positive element gives excluded middle. Conversely,
excluded middle gives the (only) positive element âŠ¥Î©.

\begin{code}

the-âˆ€-positive-props-form-a-type-equiv-to-EM
 : (Î£ q ê‰ Î© , is-positive Î©âˆ€ q) â‰ƒ EM ğ“£
the-âˆ€-positive-props-form-a-type-equiv-to-EM
 = logically-equivalent-props-are-equivalent
    the-âˆ€-positive-props-form-a-prop
    (EM-is-prop fe')
    (Î» (q , q-is-pos) â†’ âŠ¥-âˆ€-positive-gives-EM
                         (transport
                           (is-positive Î©âˆ€)
                           (âˆ€-positive-gives-equal-âŠ¥ q q-is-pos)
                           q-is-pos))
    (Î» em â†’ (âŠ¥Î© , EM-gives-âŠ¥-âˆ€-positive em))

\end{code}

Added 24th November 2025. We answer Questionâ‚ above positively. This
gives a stronger result than what is claimed above, with a simpler and
shorter proof, which in particular doesn't appeal to Higgs Involution
Theorem.

\begin{code}

module stronger-result-with-simpler-proof
        (G : ğ“£ Ì‡ )
        (G-is-set : is-set G)
        (Î¹ : G â†’ Î©)
        (Î©âˆ€-is-free : is-free-ğ“›-alg Î©âˆ€  G Î¹)
       where

 open main-results G G-is-set Î¹
 open assumption Î©âˆ€-is-free

 h-more-explicitly : (l : ğ“› G) â†’ h l ï¼ â‡ is-def l
 h-more-explicitly l@(P , Ï† , i) = I
  where
   I = h l                 ï¼âŸ¨ h-explicitly l âŸ©
       (â±¯ a ê‰ P , Î¹ (Ï† a)) ï¼âŸ¨ Iâ‚€ âŸ©
       (â±¯ a ê‰ P , âŠ¥Î©)      ï¼âŸ¨ refl âŸ©
       â‡ is-def l âˆ
     where
      Iâ‚€ = Î©-extensionality pe fe
            (Î» f a â†’ idtofun (Î¹ (Ï† a) holds) (âŠ¥Î© holds)
                      (ap _holds (Î¹-is-constantly-âŠ¥ (Ï† a)))
                      (f a))
            (Î» (Î½ : P â†’ ğŸ˜) (a : P) â†’ ğŸ˜-elim (Î½ a))

\end{code}

We say that a proposition is negative if it is logically equivalent to
a negation. A proposition is negative if and only if it is Â¬Â¬-stable
(because three negations imply one). By the above characterization of
h, as h is an equivalence, every proposition is negative, which means
that the principle of excluded middle holds.

\begin{code}

 EM-holds : EM ğ“£
 EM-holds = DNE-gives-EM fe DNE-holds
  where
   DNE-holds : (P : ğ“£ Ì‡) â†’ is-prop P â†’ Â¬Â¬ P â†’ P
   DNE-holds P P-is-prop = VI
    where
     p q : Î©
     p = (P , P-is-prop)
     q = is-def (hâ»Â¹ p)

     Q : ğ“£ Ì‡
     Q = q holds

     I = p         ï¼âŸ¨ (inverses-are-sections' ğ•™ p)â»Â¹ âŸ©
         h (hâ»Â¹ p) ï¼âŸ¨ h-more-explicitly (hâ»Â¹ p) âŸ©
         â‡ q       âˆ

     II : P ï¼ (â‡ q) holds
     II = ap _holds I

     III : P â†’ Â¬ Q
     III g q = ğŸ˜-elim (idtofun P (Q â†’ ğŸ˜) II g q)

     IV : Â¬ Q â†’ P
     IV Î½ = idtofun (Q â†’ ğŸ˜) P (II â»Â¹) (Î» (a : Q) â†’ ğŸ˜-elim (Î½ a))

     V : Â¬Â¬ P â†’ Â¬ Q
     V = three-negations-imply-one âˆ˜ Â¬Â¬-functor III

     VI : Â¬Â¬ P â†’ P
     VI = IV âˆ˜ V

\end{code}

We summarize this as follows.

\begin{code}

stronger-consequence-of-Î©âˆ€-being-freely-generated
 : (G : ğ“£ Ì‡ )
   (G-is-set : is-set G)
   (Î¹ : G â†’ Î©)
   (Î©âˆ€-is-free : is-free-ğ“›-alg Î©âˆ€ G Î¹)
 â†’ EM ğ“£
stronger-consequence-of-Î©âˆ€-being-freely-generated G G-is-set Î¹ Î©âˆ€-is-free
 = EM-holds
 where
  open stronger-result-with-simpler-proof G G-is-set Î¹ Î©âˆ€-is-free

\end{code}

In other words,

\begin{code}

positive-answer-to-Questionâ‚ : (G : ğ“£ Ì‡ )
                               (G-is-set : is-set G)
                               (Î¹ : G â†’ Î©)
                             â†’ Questionâ‚ G G-is-set Î¹
positive-answer-to-Questionâ‚ G G-is-set Î¹ Î©âˆ€-is-free =
 stronger-consequence-of-Î©âˆ€-being-freely-generated G G-is-set Î¹ Î©âˆ€-is-free

\end{code}
