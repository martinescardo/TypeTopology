{-# OPTIONS --without-K --exact-split --safe #-}

module Inhabitation where

open import Universes
open import MLTT-Agda
open import HoTT-UF-Agda
open import FunExt

is-inhabited : ğ“¤ Ì‡ â†’ ğ“¤ âº Ì‡
is-inhabited {ğ“¤} X = (P : ğ“¤ Ì‡ ) â†’ is-subsingleton P â†’ (X â†’ P) â†’ P

global-dfunext : ğ“¤Ï‰
global-dfunext = âˆ€ ğ“¤ ğ“¥ â†’ dfunext ğ“¤ ğ“¥

inhabitation-is-a-subsingleton : global-dfunext â†’ (X : ğ“¤ Ì‡ ) â†’ is-subsingleton (is-inhabited X)
inhabitation-is-a-subsingleton {ğ“¤} fe X =
  Î -is-subsingleton (fe (ğ“¤ âº) ğ“¤)
    Î» P â†’ Î -is-subsingleton (fe ğ“¤ ğ“¤)
           (Î» (s : is-subsingleton P)
                 â†’ Î -is-subsingleton (fe ğ“¤ ğ“¤) (Î» (f : X â†’ P) â†’ s))

pointed-is-inhabited : {X : ğ“¤ Ì‡ } â†’ X â†’ is-inhabited X
pointed-is-inhabited x = Î» P s f â†’ f x

inhabited-recursion : (X P : ğ“¤ Ì‡ ) â†’ is-subsingleton P â†’ (X â†’ P) â†’ is-inhabited X â†’ P
inhabited-recursion X P s f Ï† = Ï† P s f

inhabited-gives-pointed-for-subsingletons : (P : ğ“¤ Ì‡ ) â†’ is-subsingleton P â†’ is-inhabited P â†’ P
inhabited-gives-pointed-for-subsingletons P s = inhabited-recursion P P s id

inhabited-functorial : global-dfunext â†’ (X : ğ“¤ âº Ì‡ ) (Y : ğ“¤ Ì‡ )
                     â†’ (X â†’ Y) â†’ is-inhabited X â†’ is-inhabited Y
inhabited-functorial fe X Y f = inhabited-recursion
                                  X
                                  (is-inhabited Y)
                                  (inhabitation-is-a-subsingleton fe Y)
                                  (pointed-is-inhabited âˆ˜ f)

âˆƒ : {X : ğ“¤ Ì‡ } (A : X â†’ ğ“¥ Ì‡ ) â†’ (ğ“¤ âŠ” ğ“¥)âº Ì‡
âˆƒ {ğ“¤} {ğ“¥} {X} A = is-inhabited (Î£ \(x : X) â†’ A x)

image : {X : ğ“¤ Ì‡ } {Y : ğ“¥ Ì‡ } â†’ (X â†’ Y) â†’ (ğ“¤ âŠ” ğ“¥)âº Ì‡
image f = Î£ \(y : codomain f) â†’ âˆƒ \(x : domain f) â†’ f x â‰¡ y

restriction : {X : ğ“¤ Ì‡ } {Y : ğ“¥ Ì‡ } (f : X â†’ Y)
            â†’ image f â†’ Y
restriction f (y , _) = y

corestriction : {X : ğ“¤ Ì‡ } {Y : ğ“¥ Ì‡ } (f : X â†’ Y)
              â†’ X â†’ image f
corestriction f x = f x , pointed-is-inhabited (x , refl (f x))

is-surjection : {X : ğ“¤ Ì‡ } {Y : ğ“¥ Ì‡ } â†’ (X â†’ Y) â†’ (ğ“¤ âŠ” ğ“¥)âº Ì‡
is-surjection f = (y : codomain f) â†’ âˆƒ \(x : domain f) â†’ f x â‰¡ y

record propositional-truncations-exist : ğ“¤Ï‰ where
 field
  âˆ¥_âˆ¥ : {ğ“¤ : Universe} â†’ ğ“¤ Ì‡ â†’ ğ“¤ Ì‡
  âˆ¥âˆ¥-is-a-prop : {ğ“¤ : Universe} {X : ğ“¤ Ì‡ } â†’ is-prop âˆ¥ X âˆ¥
  âˆ£_âˆ£ : {ğ“¤ : Universe} {X : ğ“¤ Ì‡ } â†’ X â†’ âˆ¥ X âˆ¥
  âˆ¥âˆ¥-rec : {ğ“¤ ğ“¥ : Universe} {X : ğ“¤ Ì‡ } {P : ğ“¥ Ì‡ } â†’ is-prop P â†’ (X â†’ P) â†’ âˆ¥ X âˆ¥ â†’ P

